<!DOCTYPE html>
<head>
<meta charset="UTF-8" />
<title>Specification and Verification of Distributed Protocols</title>
<link rel="stylesheet" href="main.css" />
<link href='https://fonts.googleapis.com/css?family=Open+Sans'
    rel='stylesheet' type='text/css'>
</head>
<body>
<script>0</script>
<h1>Specification and Verification of Distributed Protocols</h1>
<p><b>by Manos Kapritsos and Jon Howell</b></p>

<p>
Fall 2024 edition, taught by Manos Kapritsos at the University of Michigan.
Please contact Manos (contact info <a href="https://manos.prof">here</a>) if
you are looking for an earlier version of the course.

<p>
This course teaches a foundation of concepts that build up to the
ability to model a distributed, asynchronous protocol and prove it safe.
By the end of the course, participants will
</p>

<ul>
<li>Be able to specify the desired behavior of real-world protocols using
    refinement.

<li>Be able to articulate the guarantees provided by verification.

<li>Learn how to model protocols and prove them safe.

<li>Demonstrate mastery by building a distributed sharded key-value store and
    proving that it always returns correct results.
</ul>
<h2>Chapter 01: Dafny Basics</h2>
This chapter introduces the mathematical subset of Dafny needed to work the exercises in the rest of the course.<p>Lectures
<ul>
<li class="li-none">
Lecture 1
<br><a href="lectures/lecture1.pdf"><div class="lec-preview"><img width=100% height=100% src="lectures/lecture1-2.png"></div></a>
<br>
<a href="lectures/lecture1.pptx">PowerPoint</a>
<a href="lectures/lecture1.pdf">PDF</a>
<a href="https://leccap.engin.umich.edu/leccap/player/r/G66ZW5">Lecture recording</a>
<p>
<li class="li-none">
Lecture 2
<br><a href="lectures/lecture2.pdf"><div class="lec-preview"><img width=100% height=100% src="lectures/lecture2-2.png"></div></a>
<br>
<a href="lectures/lecture2.pptx">PowerPoint</a>
<a href="lectures/lecture2.pdf">PDF</a>
<a href="https://leccap.engin.umich.edu/leccap/player/r/KJI6Zf">Lecture recording</a>
<p>
<li class="li-none">
Lecture 3
<br><a href="lectures/lecture3.pdf"><div class="lec-preview"><img width=100% height=100% src="lectures/lecture3-2.png"></div></a>
<br>
<a href="lectures/lecture3.pptx">PowerPoint</a>
<a href="lectures/lecture3.pdf">PDF</a>
<a href="https://leccap.engin.umich.edu/leccap/player/r/Uvo2LK">Lecture recording</a>
<p>
<li class="li-none">
Lecture 4
<br><a href="lectures/lecture4.pdf"><div class="lec-preview"><img width=100% height=100% src="lectures/lecture4-2.png"></div></a>
<br>
<a href="lectures/lecture4.pptx">PowerPoint</a>
<a href="lectures/lecture4.pdf">PDF</a>
<a href="https://leccap.engin.umich.edu/leccap/player/r/LiMXcg">Lecture recording</a>
<p>
</ul>
<p>Exercises
<ul>
<li><a href="chapter01-basics/exercises/exercise01.dfy"><b>Exercise 01: Lemmas and assertions

</b></a> 
<li><a href="chapter01-basics/exercises/exercise02.dfy"><b>Exercise 02: Boolean logic

</b></a> 
<li><a href="chapter01-basics/exercises/exercise03.dfy"><b>Exercise 03: Functions

</b></a> 
<li><a href="chapter01-basics/exercises/exercise04.dfy"><b>Exercise 04: Predicates

</b></a> 
<li><a href="chapter01-basics/exercises/exercise05.dfy"><b>Exercise 05: Sets

</b></a> 
<li><a href="chapter01-basics/exercises/exercise06.dfy"><b>Exercise 06: More set tools

</b></a> 
<li><a href="chapter01-basics/exercises/exercise07.dfy"><b>Exercise 07: Sequences: Literals, indexing

</b></a> 
<li><a href="chapter01-basics/exercises/exercise08.dfy"><b>Exercise 08: Sequences: Slices

</b></a> 
<li><a href="chapter01-basics/exercises/exercise09.dfy"><b>Exercise 09: Sequences: types, cardinality

</b></a> 
<li><a href="chapter01-basics/exercises/exercise10.dfy"><b>Exercise 10: Type synonyms

</b></a> 
<li><a href="chapter01-basics/exercises/exercise11.dfy"><b>Exercise 11: Struct (product) datatypes.

</b></a> 
<li><a href="chapter01-basics/exercises/exercise12.dfy"><b>Exercise 12: include directive and Union (sum) datatypes

</b></a> 
<li><a href="chapter01-basics/exercises/exercise13.dfy"><b>Exercise 13: More with algebraic datatypes.

</b></a> 
<li><a href="chapter01-basics/exercises/exercise14.dfy"><b>Exercise 14: Quantifiers

</b></a> 
<li><a href="chapter01-basics/exercises/exercise15.dfy"><b>Exercise 15: Maps. Set, Map and Sequence comprehensions.

</b></a> 
<li><a href="chapter01-basics/exercises/exercise16.dfy"><b>Exercise 16: IsEven

</b></a> Hoare logic


<li><a href="chapter01-basics/exercises/exercise17.dfy"><b>Exercise 17: Fibo

</b></a> Recursion challenge.


<li><a href="chapter01-basics/exercises/exercise18.dfy"><b>Exercise 18: FindMax

</b></a> Loop invariants.


<li><a href="chapter01-basics/exercises/exercise19.dfy"><b>Exercise 19: IsSeqSorted

</b></a> Build an entire imperative loop method implementation with loop

invariants.


<li><a href="chapter01-basics/exercises/exercise20.dfy"><b>Exercise 20: Binary Search

</b></a> Method implementation; writing a Hoare spec.


<li><a href="chapter01-basics/exercises/exercise21.dfy"><b>Exercise 21: Binary Tree Is Sorted

</b></a> Prove an implementation meets its spec.

Practice with proof diagnosis.


<li><a href="chapter01-basics/exercises/exercise22.dfy"><b>Exercise 22: Binary Tree Search

</b></a> Implement search in a binary tree and prove it works.

Practice with proof diagnosis.


</ul>
<p>Associated Libraries
<ul>
<li><a href="chapter01-basics/exercises/DirectionsLibrary.dfy"><b>DirectionsLibrary.dfy</b></a> Library for exercises 12 & 14


<li><a href="chapter01-basics/exercises/LunchLibrary.dfy"><b>LunchLibrary.dfy</b></a> Library for exercises 13 & 14


<li><a href="chapter01-basics/exercises/UtilitiesLibrary.dfy"><b>UtilitiesLibrary.dfy</b></a> 
</ul>
<h2>Chapter 02: Specification</h2>
Specification is how we write down what a protocol does. A verification result is only as good as its specification.<p>Lectures
<ul>
<li class="li-none">
Lecture 5
<br><a href="lectures/lecture5.pdf"><div class="lec-preview"><img width=100% height=100% src="lectures/lecture5-2.png"></div></a>
<br>
<a href="lectures/lecture5.pptx">PowerPoint</a>
<a href="lectures/lecture5.pdf">PDF</a>
<a href="https://leccap.engin.umich.edu/leccap/player/r/S9ceFe">Lecture recording</a>
<p>
</ul>
<p>Exercises
<ul>
<li><a href="chapter02-specification/exercises/exercise01.dfy"><b>Exercise 01: IsPrimeSpec I

</b></a> Basic specification.


<li><a href="chapter02-specification/exercises/exercise02.dfy"><b>Exercise 02: IsPrime II

</b></a> Working with an implementation proof


<li><a href="chapter02-specification/exercises/exercise03.dfy"><b>Merge Sort

</b></a> More specification practice.


</ul>
<h2>Chapter 03: State Machines</h2>
This chapter describes state machine models, a general tool we'll use to describe protocols and the environment they work in.<p>Lectures
<ul>
<li class="li-none">
Lecture 6
<br><a href="lectures/lecture6.pdf"><div class="lec-preview"><img width=100% height=100% src="lectures/lecture6-2.png"></div></a>
<br>
<a href="lectures/lecture6.pptx">PowerPoint</a>
<a href="lectures/lecture6.pdf">PDF</a>
<a href="https://leccap.engin.umich.edu/leccap/player/r/ygXI8S">Lecture recording</a>
<p>
<li class="li-none">
Lecture 7
<br><a href="lectures/lecture7.pdf"><div class="lec-preview"><img width=100% height=100% src="lectures/lecture7-2.png"></div></a>
<br>
<a href="lectures/lecture7.pptx">PowerPoint</a>
<a href="lectures/lecture7.pdf">PDF</a>
<a href="https://leccap.engin.umich.edu/leccap/player/r/NtdpvJ">Lecture recording</a>
<p>
<li class="li-none">
Lecture 8
<br><a href="lectures/lecture8.pdf"><div class="lec-preview"><img width=100% height=100% src="lectures/lecture8-2.png"></div></a>
<br>
<a href="lectures/lecture8.pptx">PowerPoint</a>
<a href="lectures/lecture8.pdf">PDF</a>
<a href="https://leccap.engin.umich.edu/leccap/player/r/MoEueH">Lecture recording</a>
<p>
</ul>
<p>Exercises
<ul>
<li><a href="chapter03-state-machines/exercises/exercise01.dfy"><b>Exercise 01: Coke Machine

</b></a> The first state machine specification exercise: fill in actions.


<li><a href="chapter03-state-machines/exercises/exercise02.dfy"><b>Exercise 02: Dining Philosophers

</b></a> A more challenging state machine: define the state datatype.


<li><a href="chapter03-state-machines/exercises/exercise03.dfy"><b>Exercise 03: Single-Server Lock Service Model

</b></a> A complex state machine

including a Safety predicate on the state type.


</ul>
<h2>Chapter 04: Invariants</h2>
Invariants are the central tool used to prove safety properties of protocols.<p>Lectures
<ul>
<li class="li-none">
Lecture 9
<br><a href="lectures/lecture9.pdf"><div class="lec-preview"><img width=100% height=100% src="lectures/lecture9-2.png"></div></a>
<br>
<a href="lectures/lecture9.pptx">PowerPoint</a>
<a href="lectures/lecture9.pdf">PDF</a>
<a href="https://leccap.engin.umich.edu/leccap/player/r/gRuNxR">Lecture recording</a>
<p>
<li class="li-none">
Lecture 10
<br><a href="lectures/lecture10.pdf"><div class="lec-preview"><img width=100% height=100% src="lectures/lecture10-2.png"></div></a>
<br>
<a href="lectures/lecture10.pptx">PowerPoint</a>
<a href="lectures/lecture10.pdf">PDF</a>
<a href="https://leccap.engin.umich.edu/leccap/player/r/FcIQA5">Lecture recording</a>
<p>
<li class="li-none">
Lecture 11
<br><a href="lectures/lecture11.pdf"><div class="lec-preview"><img width=100% height=100% src="lectures/lecture11-2.png"></div></a>
<br>
<a href="lectures/lecture11.pptx">PowerPoint</a>
<a href="lectures/lecture11.pdf">PDF</a>
<a href="https://leccap.engin.umich.edu/leccap/player/r/3DowwA">Lecture recording</a>
<p>
<li class="li-none">
Lecture 12
<br><a href="lectures/lecture12.pdf"><div class="lec-preview"><img width=100% height=100% src="lectures/lecture12-2.png"></div></a>
<br>
<a href="lectures/lecture12.pptx">PowerPoint</a>
<a href="lectures/lecture12.pdf">PDF</a>
<a href="https://leccap.engin.umich.edu/leccap/player/r/HjLNsF">Lecture recording</a>
<p>
</ul>
<p>Exercises
<ul>
<li><a href="chapter04-invariants/exercises/exercise01.dfy"><b>Exercise 01: Crawler

</b></a> Introduction to inductive invariants

-- implement the visualization from the lecture.


<li><a href="chapter04-invariants/exercises/exercise02.dfy"><b>Exercise 02: Single-Server Lock Service Proof

</b></a> A more realistic invariant proof of the previous chapter's lock

service.


<li><a href="chapter04-invariants/exercises/exercise03.dfy"><b>Exercise 03: Crawler quadrants

</b></a> Introduction to inductive invariants

A more advanced crawler state machine


</ul>
<h2>Chapter 05: Distributed State Machines</h2>
Here we assemble state machines in an idiomatic way to represent a protocol and the environment the protocol operates in.<p>Lectures
<ul>
<li class="li-none">
Lecture 13
<br><a href="lectures/lecture13.pdf"><div class="lec-preview"><img width=100% height=100% src="lectures/lecture13-2.png"></div></a>
<br>
<a href="lectures/lecture13.pptx">PowerPoint</a>
<a href="lectures/lecture13.pdf">PDF</a>
<a href="https://leccap.engin.umich.edu/leccap/player/r/c71e4q">Lecture recording</a>
<p>
<li class="li-none">
Lecture 14
<br><a href="lectures/lecture14.pdf"><div class="lec-preview"><img width=100% height=100% src="lectures/lecture14-2.png"></div></a>
<br>
<a href="lectures/lecture14.pptx">PowerPoint</a>
<a href="lectures/lecture14.pdf">PDF</a>
<a href="https://leccap.engin.umich.edu/leccap/player/r/qDgc0w">Lecture recording</a>
<p>
</ul>
<p>Exercises
<ul>
<li><a href="chapter05-distributed-state-machines/exercises/CommitTypes.dfy"><b>CommitTypes</b></a> 
<li><a href="chapter05-distributed-state-machines/exercises/exercise01.dfy"><b>Exercise 01: Two Phase Commit Model

</b></a> Model a distributed protocol using compound state machines.


<li><a href="chapter05-distributed-state-machines/exercises/exercise02.dfy"><b>Exercise 02: Two Phase Commit Safety Specification Predicate

</b></a> Express the English Atomic Commit safety properties as predicates

over the compound state machine model from exercise01.


<li><a href="chapter05-distributed-state-machines/exercises/exercise03.dfy"><b>Exercise 03: Two Phase Commit Safety Proof

</b></a> Prove that the 2PC distributed system (from exercise01) accomplishes the Safety spec (from exercise02)


</ul>
<p>Associated Libraries
<ul>
<li><a href="chapter05-distributed-state-machines/exercises/UtilitiesLibrary.dfy"><b>UtilitiesLibrary.dfy</b></a> 
</ul>
<h2>Project 01: Distributed Lock Server</h2>
This midterm project demonstrates mastery of the concepts in chapters 1—5.<p>Lectures
<ul>
</ul>
<p>Exercises
<ul>
<li><a href="project01-distributed-lock-server/exercises/distributed_system.t.dfy"><b>DistributedSystem

</b></a> This file isn't editable because it's a trusted file that specifies how

hosts interact with one another over the network.


<li><a href="project01-distributed-lock-server/exercises/exercise01.dfy"><b>Exercise 01: Midterm Project

</b></a> Build a distributed lock server. Define how a host implements your

protocol in host.v.dfy; write your safety spec and proof here.


<li><a href="project01-distributed-lock-server/exercises/host.v.dfy"><b>Host protocol

</b></a> Define the host state machine here: message type, state machine for executing one

host's part of the protocol.


<li><a href="project01-distributed-lock-server/exercises/network.t.dfy"><b>Network

</b></a> This file isn't editable because it's a trusted file that specifies how

the network delivers packets, allowing reorder and duplicate delivery.


</ul>
<p>Associated Libraries
<ul>
<li><a href="project01-distributed-lock-server/exercises/UtilitiesLibrary.dfy"><b>UtilitiesLibrary.dfy</b></a> 
</ul>
<h2>Chapter 06: Refinement</h2>
Refinement helps us write a specification that abstracts away the implementation details of the protocol.<p>Lectures
<ul>
<li class="li-none">
Lecture 15
<br><a href="lectures/lecture15.pdf"><div class="lec-preview"><img width=100% height=100% src="lectures/lecture15-2.png"></div></a>
<br>
<a href="lectures/lecture15.pptx">PowerPoint</a>
<a href="lectures/lecture15.pdf">PDF</a>
<a href="https://leccap.engin.umich.edu/leccap/player/r/xh75Ml">Lecture recording</a>
<p>
<li class="li-none">
Lecture 16
<br><a href="lectures/lecture16.pdf"><div class="lec-preview"><img width=100% height=100% src="lectures/lecture16-2.png"></div></a>
<br>
<a href="lectures/lecture16.pptx">PowerPoint</a>
<a href="lectures/lecture16.pdf">PDF</a>
<a href="https://leccap.engin.umich.edu/leccap/player/r/64iXvL">Lecture recording</a>
<p>
<li class="li-none">
Lecture 17
<br><a href="lectures/lecture17.pdf"><div class="lec-preview"><img width=100% height=100% src="lectures/lecture17-2.png"></div></a>
<br>
<a href="lectures/lecture17.pptx">PowerPoint</a>
<a href="lectures/lecture17.pdf">PDF</a>
<a href="https://leccap.engin.umich.edu/leccap/player/r/KhmeWz">Lecture recording</a>
<p>
<li class="li-none">
Lecture 18
<br><a href="lectures/lecture18.pdf"><div class="lec-preview"><img width=100% height=100% src="lectures/lecture18-2.png"></div></a>
<br>
<a href="lectures/lecture18.pptx">PowerPoint</a>
<a href="lectures/lecture18.pdf">PDF</a>
<a href="https://leccap.engin.umich.edu/leccap/player/r/91iysu">Lecture recording</a>
<p>
<li class="li-none">
Lecture 19
<br><a href="lectures/lecture19.pdf"><div class="lec-preview"><img width=100% height=100% src="lectures/lecture19-2.png"></div></a>
<br>
<a href="lectures/lecture19.pptx">PowerPoint</a>
<a href="lectures/lecture19.pdf">PDF</a>
<a href="https://leccap.engin.umich.edu/leccap/player/r/tdHSiU">Lecture recording</a>
<p>
</ul>
<p>Exercises
<ul>
<li><a href="chapter06-refinement/exercises/exercise01.dfy"><b>Exercise 01: Event-based refinement

</b></a> You are asked to provide the abstraction function and refinement proof

for a system describing the interactions among baristas and clients

when handing out, receiving and transfering bathroom keys.


</ul>
<p>Associated Libraries
<ul>
<li><a href="chapter06-refinement/exercises/UtilitiesLibrary.dfy"><b>UtilitiesLibrary.dfy</b></a> 
</ul>
<h2>Project 02: Sharded Key-Value Store</h2>
This final project demonstrates mastery of the concepts in chapters 1—6.<p>Lectures
<ul>
</ul>
<p>Exercises
<ul>
<li><a href="project02-sharded-kv-store/exercises/AtomicKVSpec.t.dfy"><b>AtomicKVSpec.t</b></a> 
<li><a href="project02-sharded-kv-store/exercises/DistributedSystem.t.dfy"><b>DistributedSystem.t</b></a> 
<li><a href="project02-sharded-kv-store/exercises/Host.v.dfy"><b>Host.v</b></a> 
<li><a href="project02-sharded-kv-store/exercises/MessageType.v.dfy"><b>MessageType.v</b></a> 
<li><a href="project02-sharded-kv-store/exercises/Network.t.dfy"><b>Network.t</b></a> 
<li><a href="project02-sharded-kv-store/exercises/RefinementObligation.t.dfy"><b>RefinementObligation.t</b></a> 
<li><a href="project02-sharded-kv-store/exercises/RefinementProof.v.dfy"><b>RefinementProof.v</b></a> 
<li><a href="project02-sharded-kv-store/exercises/Types.t.dfy"><b>Types.t</b></a> 
</ul>
<p>Associated Libraries
<ul>
<li><a href="project02-sharded-kv-store/exercises/IMapHelpers.t.dfy"><b>IMapHelpers.t.dfy</b></a> 
<li><a href="project02-sharded-kv-store/exercises/UtilitiesLibrary.t.dfy"><b>UtilitiesLibrary.t.dfy</b></a> 
</ul>
<h2>Auxiliary Material: </h2>
<p>Lectures
<ul>
<li class="li-none">
Lecture 20
<br><a href="lectures/lecture20.pdf"><div class="lec-preview"><img width=100% height=100% src="lectures/lecture20-2.png"></div></a>
<br>
<a href="lectures/lecture20.pptx">PowerPoint</a>
<a href="lectures/lecture20.pdf">PDF</a>
<a href="https://leccap.engin.umich.edu/leccap/player/r/ZMkfGC">Lecture recording</a>
<p>
</ul>
</body>
